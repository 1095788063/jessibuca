(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{319:function(t,e,i){},388:function(t,e,i){"use strict";var r=i(319);i.n(r).a},391:function(t,e,i){"use strict";i.r(e);i(165),i(355),i(181),i(9),i(357),i(362),i(364),i(365),i(366),i(367),i(368),i(369),i(370),i(371),i(372),i(373),i(374),i(376),i(377),i(378),i(379),i(380),i(381),i(382),i(383),i(384),i(385),i(386),i(387);var r=i(40);function n(t){var e=this;this.canvasElement=document.createElement("canvas"),this.canvasElement.style.position="absolute",this.canvasElement.style.top=0,this.canvasElement.style.left=0,t.container.appendChild(this.canvasElement),this.width=t.container.clientWidth,this.height=t.container.clientHeight,this.container=t.container,this.container.style.overflow="hidden",this.containerOldPostion={position:this.container.style.position,top:this.container.style.top,left:this.container.style.left,width:this.container.style.width,height:this.container.style.height},"absolute"!=this.containerOldPostion.position&&(this.container.style.position="relative"),this.contextOptions=t.contextOptions,this.videoBuffer=t.videoBuffer||0,t.forceNoGL||this.initContextGL(),this.audioContext=new AudioContext,t.mute&&(this.audioEnabled(!0),this.audioEnabled(!1)),this.contextGL&&(this.initProgram(),this.initBuffers(),this.initTextures()),this.onresize=function(){return e.resize()},window.addEventListener("resize",this.onresize),this.decoderWorker=new Worker(t.decoder||"ff.js");var i=this;this.decoderWorker.onmessage=function(t){var e=t.data;switch(e.cmd){case"init":console.log("decoder worker init"),this.postMessage({cmd:"setVideoBuffer",time:i.videoBuffer}),i.onLoad&&(i.onLoad(),delete i.onLoad);break;case"initSize":i.canvasElement.width=e.w,i.canvasElement.height=e.h,i.resize(),console.log("video size:",e.w,e.h),i.isWebGL()||i.initRGB(e.w,e.h);break;case"render":i.onPlay&&(i.onPlay(),delete i.onPlay),i.contextGL?i.drawNextOuptutPictureGL(e.output):i.drawNextOuptutPictureRGBA(e.buffer);break;case"initAudio":i.initAudioPlay(e.frameCount,e.samplerate,e.channels);break;case"playAudio":i.playAudio(e.buffer);break;case"print":console.log(e.text);break;case"printErr":console.error(e.text);break;default:i[e.cmd](e)}}}n.prototype.initAudioPlanar=function(t){var e=t.channels,i=t.samplerate;console.log("initAudioPlanar:","channles:",e,"samplerate:",i);var r=this.audioContext,n=!1,a=[];if(!r)return!1;var o=this;this.playAudio=function(t){var s=t[0][0].length,c=r.createBuffer(e,s*t.length,i),u=function(i){if(i)if(n)a.push(i);else{n=!0,function(i){for(var r=0;r<e;r++)for(var n=c.getChannelData(r),a=0;a<t.length;a++)for(var o=0;o<s;o++)n[o+a*s]=i[a][r][o]}(i);var o=r.createBufferSource();o.buffer=c,o.connect(r.destination),o.start()}};o.playAudio=u,o.audioInterval=setInterval((function(){n=!1,a.length&&u(a.shift())}),1e3*c.duration),u(t)}},n.prototype.audioEnabled=function(t){t?(!function(t){t.resume();var e=t.createBufferSource();e.buffer=t.createBuffer(1,1,22050),e.connect(t.destination),e.noteOn?e.noteOn(0):e.start(0)}(this.audioContext),this.audioEnabled=function(t){t?this.audioContext.resume():this.audioContext.suspend()}):this.audioContext.suspend()},n.prototype.playAudio=function(t){var e=this.audioContext,i=!1,n=!1;if(!e)return!1;var a=[],o=[],s=this,c=function(t){a.length&&u(a.shift())},u=function(t){i=!0;var r=e.createBufferSource();r.buffer=t,r.connect(e.destination),r.start(),s.audioInterval||(s.audioInterval=setInterval(c,1e3*t.duration-1))},h=function t(){o.length?e.decodeAudioData(o.shift(),l,t):n=!1},l=function(t){h(),i?a.push(t):u(t)},d=function(t){o.push.apply(o,Object(r.a)(t)),n||(n=!0,h())};this.playAudio=d,d(t)},n.prototype.initAudioPlay=function(t,e,i){var r=this.audioContext,n=!1,a=[];if(!r)return!1;var o=this,s=e<22050;s&&console.log("resampled!");var c=s?r.createBuffer(i,t<<1,e<<1):r.createBuffer(i,t,e),u=function(){n=!1,a.length&&l(a.shift())},h=i>1?function(e){for(var r=0;r<i;r++){var n=c.getChannelData(r);if(s)for(var a=0;a<t;a++)n[2*a]=n[2*a+1]=e[a*(r+1)]/32768;else for(a=0;a<t;a++)n[a]=e[a*(r+1)]/32768}}:function(t){for(var e=c.getChannelData(0),i=0;i<e.length;i++)e[i]=t[i]/32768},l=function(t){if(n)a.push(t);else{n=!0,h(t);var e=r.createBufferSource();e.buffer=c,e.connect(r.destination),o.audioInterval||(o.audioInterval=setInterval(u,1e3*c.duration)),e.start()}};this.playAudio=l},n.prototype.isWebGL=function(){return!!this.contextGL},n.prototype.initContextGL=function(){for(var t=this.canvasElement,e=null,i=["webgl","experimental-webgl","moz-webgl","webkit-3d"],r=0;!e&&r<i.length;){var n=i[r];try{e=this.contextOptions?t.getContext(n,this.contextOptions):t.getContext(n)}catch(t){e=null}e&&"function"==typeof e.getParameter||(e=null),++r}this.contextGL=e},n.prototype.initProgram=function(){var t=this.contextGL,e=["attribute vec4 vertexPos;","attribute vec4 texturePos;","varying vec2 textureCoord;","void main()","{","gl_Position = vertexPos;","textureCoord = texturePos.xy;","}"].join("\n"),i=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","const mat4 YUV2RGB = mat4","(","1.1643828125, 0, 1.59602734375, -.87078515625,","1.1643828125, -.39176171875, -.81296875, .52959375,","1.1643828125, 2.017234375, 0, -1.081390625,","0, 0, 0, 1",");","void main(void) {","highp float y = texture2D(ySampler,  textureCoord).r;","highp float u = texture2D(uSampler,  textureCoord).r;","highp float v = texture2D(vSampler,  textureCoord).r;","gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n"),r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+t.getShaderInfoLog(r));var n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+t.getShaderInfoLog(n));var a=t.createProgram();t.attachShader(a,r),t.attachShader(a,n),t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||console.log("Program failed to compile: "+t.getProgramInfoLog(a)),t.useProgram(a),this.shaderProgram=a},n.prototype.initBuffers=function(){var t=this.contextGL,e=this.shaderProgram,i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW);var r=t.getAttribLocation(e,"vertexPos");t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0);var n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var a=t.getAttribLocation(e,"texturePos");t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),this.texturePosBuffer=n},n.prototype.initTextures=function(){var t=this.contextGL,e=this.shaderProgram,i=this.initTexture(),r=t.getUniformLocation(e,"ySampler");t.uniform1i(r,0),this.yTextureRef=i;var n=this.initTexture(),a=t.getUniformLocation(e,"uSampler");t.uniform1i(a,1),this.uTextureRef=n;var o=this.initTexture(),s=t.getUniformLocation(e,"vSampler");t.uniform1i(s,2),this.vTextureRef=o},n.prototype.initTexture=function(){var t=this.contextGL,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),e},n.prototype.drawNextOutputPicture=function(t){this.contextGL?this.drawNextOuptutPictureGL(t):this.drawNextOuptutPictureRGBA(t)},n.prototype.drawNextOuptutPictureGL=function(t){var e=this.contextGL,i=this.texturePosBuffer,r=this.yTextureRef,n=this.uTextureRef,a=this.vTextureRef,o=this.croppingParams,s=this.canvasElement.width,c=this.canvasElement.height;if(o){e.viewport(0,0,o.width,o.height);var u=o.top/c,h=o.left/s,l=o.height/c,d=o.width/s,f=new Float32Array([d,u,h,u,d,l,h,l]);e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,f,e.DYNAMIC_DRAW)}else e.viewport(0,0,this.canvasElement.width,this.canvasElement.height);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,s,c,0,e.LUMINANCE,e.UNSIGNED_BYTE,t[0]),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,s/2,c/2,0,e.LUMINANCE,e.UNSIGNED_BYTE,t[1]),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,s/2,c/2,0,e.LUMINANCE,e.UNSIGNED_BYTE,t[2]),e.drawArrays(e.TRIANGLE_STRIP,0,4)},n.prototype.drawNextOuptutPictureRGBA=function(t){this.imageData.data.set(t);var e=this.croppingParams;e?this.ctx2d.putImageData(this.imageData,-e.left,-e.top,0,0,e.width,e.height):this.ctx2d.putImageData(this.imageData,0,0)},n.prototype.ctx2d=null,n.prototype.imageData=null,n.prototype.initRGB=function(t,e){this.ctx2d=this.canvasElement.getContext("2d"),this.imageData=this.ctx2d.getImageData(0,0,t,e),this.clear=function(){this.ctx2d.clearRect(0,0,t,e)}},n.prototype.close=function(){this.audioInterval&&clearInterval(this.audioInterval),delete this.playAudio,this.decoderWorker.postMessage({cmd:"close"}),this.contextGL.clear(this.contextGL.COLOR_BUFFER_BIT)},n.prototype.destroy=function(){this.decoderWorker.terminate(),window.removeEventListener("resize",this.onresize)},n.prototype.play=function(t){this.decoderWorker.postMessage({cmd:"play",url:t,isWebGL:this.isWebGL()})},Object.defineProperty(n.prototype,"fullscreen",{set:function(t){t?this.container.requestFullscreen():document.exitFullscreen()}}),n.prototype.resize=function(){this.width=this.container.clientWidth,this.height=this.container.clientHeight;var t=this.width/this.canvasElement.width,e=this.height/this.canvasElement.height,i=t>e?e:t;this.canvasElement.style.transform="scale("+i+")",this.canvasElement.style.left=(this.width-this.canvasElement.width)/2+"px",this.canvasElement.style.top=(this.height-this.canvasElement.height)/2+"px"};var a=n,o={name:"DemoPlayer",data:function(){return{jessibuca:null,wasm:!1,vc:"ff",playing:!1,err:""}},computed:{decoder:function(){return this.vc+(this.wasm?"_wasm":"")+".js"}},watch:{decoder:function(t){var e=this;this.jessibuca&&this.jessibuca.destroy(),this.jessibuca=new a({container:this.$refs.container,decoder:t,videoBuffer:.2}),this.jessibuca.onPlay=function(){return e.playing=!0},this.playing=!1}},mounted:function(){var t=this;this.jessibuca=new a({container:this.$refs.container,decoder:this.decoder,videoBuffer:.2}),this.jessibuca.onPlay=function(){return t.playing=!0},onerror=function(e){return t.err=e}},destroyed:function(){this.jessibuca.destroy()},methods:{play:function(){this.jessibuca.play(this.$refs.playUrl.value),this.err="loading"},stop:function(){this.jessibuca.close(),this.playing=!1,this.err=""},fullscreen:function(){this.jessibuca.fullscreen=!0},changeVC:function(){this.vc=["ff","libhevc_aac"][this.$refs.vc.selectedIndex]},changeWasm:function(){this.wasm=this.$refs.wasm.checked}}},s=(i(388),i(42)),c=Object(s.a)(o,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"root"},[i("div",{staticClass:"container-shell"},[i("div",{ref:"container",attrs:{id:"container"}}),t._v(" "),i("div",{staticClass:"input"},[i("div",[t._v("输入URL：")]),t._v(" "),i("input",{ref:"playUrl",attrs:{autocomplete:"on"}}),t._v(" "),t.playing?i("button",{on:{click:t.stop}},[t._v("停止")]):i("button",{on:{click:t.play}},[t._v("播放")]),t._v(" "),i("button",{on:{click:t.fullscreen}},[t._v("全屏")])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.playing,expression:"!playing"}],staticClass:"err"},[t._v(t._s(t.err))]),t._v(" "),i("div",{staticClass:"option"},[i("input",{ref:"wasm",attrs:{type:"checkbox"},on:{change:t.changeWasm}}),i("span",{staticClass:"wasm"},[t._v("wasm")]),t._v(" "),i("select",{ref:"vc",on:{change:t.changeVC}},[i("option",{attrs:{selected:""}},[t._v("h264")]),t._v(" "),i("option",[t._v("h265")])])])])])}),[],!1,null,null,null);e.default=c.exports}}]);